---
layout: post
title: "Implementation of Coroutine in Cpp"
date: 2020-11-21 18:18:00
categories: Lang
---

# Implementation of Coroutine in Cpp

If you are interested in how to write a python generator or a lua coroutine in C++, this code does the job for you

I am not going to explain how it works, but if you are interested in the implementation, feel free to read the source code...

I wrote some posts on the story of how I came up with this idea, but all of them are in Chinese. Read them here: [Cartesian Product](https://freopen.com/lang/2020/08/11/Cartesian-Product.html) and [Cartesian Product 2](https://freopen.com/lang/2020/11/19/Cartesian-Product-2.html)

This small implememation is very easy to use, so I wrote an usage manual in the souece code to show how to use it. 

If you still have any questions on how to use it, or some new ideas on this topic, feel free to send me an email.

Hope you enjoy my code, and have fun to play with it! :)

Version 1:
[**Source Code with Manual and Examples**](https://github.com/FiveEyes/FiveEyes.github.io/blob/master/assets/code/cpp/macro_yield.cpp)

After I read the source code generated by the preprocessor, it was a big surprise for me, the switch statement is much more powerful than I thought...

And I did some research online, and found someone had the same idea decades ago, [Coroutines in C](https://www.chiark.greenend.org.uk/~sgtatham/coroutines.html). So, I simplify my code and update it to version 2.

In version 2, it's free to use the control flow statements in cpp... and we don't need to declare the YIELD statement before using it.

Example:
```
PRG_BEG
for(i = 0; i < 10; ++i) {
  output = i;
  YIELD();
}
PRG_END
```

The ONLY thing must be kept in mind is that all local variables are better to become the members of the generator class!
The OTHER thing is that NEVER have two YIELD() in the same line!

Version 2:
[**Source Code with Examples**](https://github.com/FiveEyes/FiveEyes.github.io/blob/master/assets/code/cpp/macro_v2.cpp)
